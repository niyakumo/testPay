{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Auth &amp; 2FA OTP API \u2014 Product &amp; System Spec","text":""},{"location":"#executive-summary","title":"Executive Summary","text":"<p>\u0426\u0435\u043b\u044c: \u041e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0442\u044c \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u0443\u044e \u0434\u0432\u0443\u0445\u0444\u0430\u043a\u0442\u043e\u0440\u043d\u0443\u044e \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c OTP-\u043a\u043e\u0434\u043e\u0432 \u0438 \u0432\u044b\u0434\u0430\u0447\u0435\u0439 JWT-\u0442\u043e\u043a\u0435\u043d\u043e\u0432.</p> <p>\u0427\u0442\u043e \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442: - \u0417\u0430\u043f\u0443\u0441\u043a \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 OTP. - \u0412\u0435\u0440\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f OTP-\u043a\u043e\u0434\u0430 \u0438 \u0432\u044b\u0434\u0430\u0447\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0433\u043e \u043a\u043e\u0434\u0430. - \u041e\u0431\u043c\u0435\u043d \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0433\u043e \u043a\u043e\u0434\u0430 \u043d\u0430 access/refresh \u0442\u043e\u043a\u0435\u043d\u044b. - \u0420\u043e\u0442\u0430\u0446\u0438\u044f refresh-\u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u0441 \u0437\u0430\u0449\u0438\u0442\u043e\u0439 \u043e\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f. - \u041b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0438 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u044b\u0445\u043e\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b. - \u041f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0439 \u0434\u043b\u044f \u0432\u0435\u0440\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 JWT (JWKS).</p> <p>\u0427\u0442\u043e \u041d\u0415 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442: \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u043b\u043e\u0433\u0438\u043d\u044b, web-SSO, \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u044b KYC.</p> <p>\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u044b\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u044f: - OAuth 2.1 \u0441 Authorization Code flow + PKCE (S256). - JWT-\u0442\u043e\u043a\u0435\u043d\u044b \u0441 \u043f\u043e\u0434\u043f\u0438\u0441\u044c\u044e ES256/Ed25519, \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 <code>kid</code>, \u0437\u0430\u043f\u0440\u0435\u0442 <code>alg=\"none\"</code>. - Refresh Token Rotation \u0441 \u0434\u0435\u0442\u0435\u043a\u0446\u0438\u0435\u0439 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f. - \u041e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0439 DPoP (\u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u043a \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0443).</p> <p>\u041a\u0440\u0438\u0442\u0435\u0440\u0438\u0438 \u0433\u043e\u0442\u043e\u0432\u043d\u043e\u0441\u0442\u0438: \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u044b \u0438 \u043f\u043e\u043a\u0440\u044b\u0442\u044b \u0442\u0435\u0441\u0442\u0430\u043c\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0435 \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438; \u043f\u043e\u043b\u043d\u0430\u044f OpenAPI 3.1 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f (\u043f\u0440\u0438\u043c\u0435\u0440\u044b, \u0441\u0445\u0435\u043c\u044b \u043e\u0448\u0438\u0431\u043e\u043a); \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u044b \u043d\u0435\u0433\u0430\u0442\u0438\u0432\u043d\u044b\u0435 \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438 \u0438 \u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0437\u043b\u043e\u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0439; \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u044b \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433, \u043c\u0435\u0442\u0440\u0438\u043a\u0438 \u0438 \u0430\u0443\u0434\u0438\u0442.</p>"},{"location":"#1","title":"1. \u041a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0438 \u0446\u0435\u043b\u0438","text":""},{"location":"#_1","title":"\u0426\u0435\u043b\u0435\u0432\u0430\u044f \u0430\u0443\u0434\u0438\u0442\u043e\u0440\u0438\u044f","text":"<p>\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u0448\u0435\u043b\u044c\u043a\u0430 \u043d\u0430 iOS \u0438 Android.</p>"},{"location":"#kpi","title":"\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043c\u0435\u0442\u0440\u0438\u043a\u0438 (KPI)","text":"<ol> <li>\u041a\u043e\u043d\u0432\u0435\u0440\u0441\u0438\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 (\u0443\u0441\u043f\u0435\u0448\u043d\u044b\u0435 / \u0432\u0441\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0438).</li> <li>\u0412\u0440\u0435\u043c\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0442\u043e\u043a\u0435\u043d\u0430 (start \u2192 access_token).</li> <li>\u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e OTP (\u0434\u043e\u043b\u044f <code>otp_invalid</code> / <code>otp_expired</code>).</li> <li>\u0427\u0430\u0441\u0442\u043e\u0442\u0430 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 OTP.</li> </ol>"},{"location":"#otp","title":"\u041f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 OTP","text":"<ul> <li>\u041e\u0434\u043d\u043e\u0440\u0430\u0437\u043e\u0432\u044b\u0435 \u043a\u043e\u0434\u044b: 6-\u0437\u043d\u0430\u0447\u043d\u044b\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u044b\u0435.</li> <li>\u0412\u0440\u0435\u043c\u044f \u0436\u0438\u0437\u043d\u0438: 3 \u043c\u0438\u043d\u0443\u0442\u044b (180 \u0441\u0435\u043a\u0443\u043d\u0434).</li> <li>\u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0437\u043b\u043e\u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0439: \u043b\u0438\u043c\u0438\u0442\u044b \u043d\u0430 \u043f\u043e\u043f\u044b\u0442\u043a\u0438 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438.</li> <li>\u0412\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438 \u043f\u0440\u0438 \u043f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u0438\u0438 \u043b\u0438\u043c\u0438\u0442\u043e\u0432.</li> </ul>"},{"location":"#_2","title":"\u0412\u043d\u0435\u0448\u043d\u0438\u0435 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438","text":"<ul> <li>OTP-\u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u044b: SMS-\u0448\u043b\u044e\u0437 \u0438 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u0448\u043b\u044e\u0437 (email) \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438 \u043a\u043e\u0434\u043e\u0432.</li> <li>\u041b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f: \u043c\u043d\u043e\u0433\u043e\u044f\u0437\u044b\u0447\u043d\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0430\u0445.</li> <li>\u0410\u0443\u0434\u0438\u0442: \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438 \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433\u0430 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438.</li> </ul>"},{"location":"#2","title":"2. \u0422\u0435\u0440\u043c\u0438\u043d\u044b \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f","text":"<p>\u0413\u0440\u0443\u043f\u043f\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f (Refresh Token Group) \u2014 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440 refresh-\u0442\u043e\u043a\u0435\u043d\u043e\u0432, \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u0440\u043e\u0442\u0430\u0446\u0438\u0438 \u043e\u0442 \u043e\u0431\u0449\u0435\u0433\u043e \u00ab\u043f\u0440\u0435\u0434\u043a\u0430\u00bb. \u041f\u0440\u0438 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u0438\u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u043b\u044e\u0431\u043e\u0433\u043e \u0443\u0441\u0442\u0430\u0440\u0435\u0432\u0448\u0435\u0433\u043e \u0442\u043e\u043a\u0435\u043d\u0430 \u0432\u0441\u044f \u0433\u0440\u0443\u043f\u043f\u0430 \u043f\u043e\u043c\u0435\u0447\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0441\u043a\u043e\u043c\u043f\u0440\u043e\u043c\u0435\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u0438 \u043e\u0442\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f.</p> <p>Challenge \u2014 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u0441\u0435\u0441\u0441\u0438\u044f \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438, \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u0430\u044f \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0432\u0445\u043e\u0434\u0430; \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e\u0431 OTP \u0438 \u0435\u0433\u043e \u0441\u0442\u0430\u0442\u0443\u0441\u0435.</p> <p>PKCE (Proof Key for Code Exchange) \u2014 \u0437\u0430\u0449\u0438\u0442\u0430 Authorization Code flow \u043e\u0442 \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u0430 \u043a\u043e\u0434\u0430 (S256).</p> <p>DPoP (Demonstration of Proof-of-Possession) \u2014 \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u0430\u044f \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u043a \u043a\u043b\u044e\u0447\u0443 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430.</p>"},{"location":"#3","title":"3. \u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b","text":""},{"location":"#_3","title":"\u0412\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b","text":"<pre><code>otp_ttl: 180s                    # \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e 120\u2013300s\nauthorization_code_ttl: 60s\naccess_token_ttl: 10m\nrefresh_token_ttl: 30d\nrefresh_group_retention: 45d     # \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u043f\u043e\u043c\u0435\u0442\u043e\u043a \u043e \u0441\u043a\u043e\u043c\u043f\u0440\u043e\u043c\u0435\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0433\u0440\u0443\u043f\u043f\u0430\u0445\nclock_skew: \u00b160s\n</code></pre>"},{"location":"#_4","title":"\u041b\u0438\u043c\u0438\u0442\u044b \u0438 \u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0437\u043b\u043e\u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0439","text":"<pre><code>start_limits:                    # /auth/start\n  per_identifier_device: 5/min, 20/hour\n  per_ip: 60/min\n\nverify_limits:                   # /auth/otp/verify\n  attempts_per_challenge: 5      # \u043f\u043e\u0441\u043b\u0435 \u0438\u0441\u0447\u0435\u0440\u043f\u0430\u043d\u0438\u044f \u2014 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0430 15 \u043c\u0438\u043d\n\nresend_limits:                   # \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u0430\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 OTP\n  min_interval: 30s\n  max_per_challenge: 3/10min\n</code></pre>"},{"location":"#_5","title":"\u0418\u0434\u0435\u043c\u043f\u043e\u0442\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u044c","text":"<ul> <li><code>POST /auth/start</code> \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a <code>Idempotency-Key</code>.</li> <li>\u041f\u0440\u0438 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0438 \u043a\u043b\u044e\u0447\u0430 \u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e challenge \u0432 \u043f\u0440\u0435\u0434\u0435\u043b\u0430\u0445 TTL \u0441\u0435\u0440\u0432\u0438\u0441 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 <code>202 Accepted</code> \u0441 \u0442\u0435\u043a\u0443\u0449\u0438\u043c <code>challenge_id</code> \u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0451\u043d\u043d\u044b\u043c <code>retry_after</code> \u0431\u0435\u0437 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 OTP.</li> </ul>"},{"location":"#_6","title":"\u0424\u043e\u0440\u043c\u0430\u0442\u044b \u0438 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u044b","text":"<ul> <li>OTP: 6-\u0437\u043d\u0430\u0447\u043d\u044b\u0435 \u0447\u0438\u0441\u043b\u0430, \u043a\u0440\u0438\u043f\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u0442\u043e\u0439\u043a\u0430\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f.</li> <li>\u0425\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435: \u0441\u0442\u043e\u0439\u043a\u0438\u0435 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u044b \u0441 \u0441\u043e\u043b\u044c\u044e \u0438 \u00abpepper\u00bb.</li> <li>JWT \u043f\u043e\u0434\u043f\u0438\u0441\u044c: ES256 \u0438\u043b\u0438 Ed25519, \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 <code>kid</code>, \u0437\u0430\u043f\u0440\u0435\u0442 <code>alg=\"none\"</code>.</li> <li>PKCE: \u0442\u043e\u043b\u044c\u043a\u043e \u043c\u0435\u0442\u043e\u0434 S256.</li> </ul>"},{"location":"#otp_1","title":"\u041a\u0430\u043d\u0430\u043b\u044b \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438 OTP","text":"<ul> <li>\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0435: SMS, email, TOTP (authenticator apps).</li> <li>SMS/Email: \u0414\u043e\u0441\u0442\u0430\u0432\u043a\u0430 \u0447\u0435\u0440\u0435\u0437 \u0432\u043d\u0435\u0448\u043d\u0438\u0435 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u044b, \u0435\u0441\u0442\u044c \u0437\u0430\u0442\u0440\u0430\u0442\u044b \u043d\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443.</li> <li>TOTP: Google Authenticator, Authy \u0438 \u0434\u0440. \u2014 \u0431\u0435\u0437 \u0437\u0430\u0442\u0440\u0430\u0442, \u043d\u043e \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438.</li> <li>\u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435: \u0441\u043c\u0435\u043d\u0430 \u043a\u0430\u043d\u0430\u043b\u0430 \u043f\u0440\u0438 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u043c challenge \u2014 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u0430 (<code>channel_locked</code>).</li> </ul>"},{"location":"#4","title":"4. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u044b","text":"<p>\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b: Mobile App \u00b7 Auth API \u00b7 OTP Gateway \u00b7 Key Service (JWKS) \u00b7 Rate Limiter \u00b7 Audit Service.</p>"},{"location":"#5","title":"5. \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0435 \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438","text":""},{"location":"#51","title":"5.1 \u0412\u0445\u043e\u0434 \u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 (\u0441 \u0430\u043b\u044c\u0442\u0435\u0440\u043d\u0430\u0442\u0438\u0432\u0430\u043c\u0438)","text":"<pre><code>sequenceDiagram\n    autonumber\n    participant App as Mobile App\n    participant Auth as Auth API\n    participant OTP as OTP Gateway\n    participant Keys as Key Service\n\n    App-&gt;&gt;Auth: POST /auth/start\n    alt \u043b\u0438\u043c\u0438\u0442 \u043d\u0435 \u0438\u0441\u0447\u0435\u0440\u043f\u0430\u043d\n        Auth-&gt;&gt;OTP: \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c OTP\n        Auth--&gt;&gt;App: 202 challenge_id, retry_after\n    else \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 challenge \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442\n        Auth--&gt;&gt;App: 202 challenge_id existing, retry_after\n    else \u0441\u043c\u0435\u043d\u0430 \u043a\u0430\u043d\u0430\u043b\u0430 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u0430\n        Auth--&gt;&gt;App: 400 channel_locked\n    else \u043f\u0440\u0435\u0432\u044b\u0448\u0435\u043d \u043b\u0438\u043c\u0438\u0442\n        Auth--&gt;&gt;App: 429 rate_limited, retry_after\n    end\n\n    App-&gt;&gt;Auth: POST /auth/otp/verify\n    alt \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0438 \u043d\u0435 \u043f\u0440\u043e\u0441\u0440\u043e\u0447\u0435\u043d\n        Auth--&gt;&gt;App: 200 authorization_code\n    else \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439\n        Auth--&gt;&gt;App: 400 otp_invalid\n    else \u043f\u0440\u043e\u0441\u0440\u043e\u0447\u0435\u043d\n        Auth--&gt;&gt;App: 400 otp_expired\n    else \u043a\u043e\u0434 \u0443\u0436\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\n        Auth--&gt;&gt;App: 400 code_redeemed\n    end\n\n    App-&gt;&gt;Auth: POST /oauth/token\n    alt PKCE \u0432\u0430\u043b\u0438\u0434\u0435\u043d \u0438 \u043a\u043e\u0434 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\n        Auth-&gt;&gt;Keys: \u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c JWT\n        Auth--&gt;&gt;App: 200 access_token, refresh_token\n    else \u043e\u0448\u0438\u0431\u043a\u0430 PKCE/\u043a\u043e\u0434\u0430\n        Auth--&gt;&gt;App: 400 invalid_grant\n    end</code></pre>"},{"location":"#52","title":"5.2 \u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 (\u0434\u0435\u0442\u0435\u043a\u0446\u0438\u044f \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f)","text":"<pre><code>sequenceDiagram\n    autonumber\n    participant App1 as App Instance 1\n    participant App2 as App Instance 2\n    participant Auth as Auth API\n\n    par \u041f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b\n        App1-&gt;&gt;Auth: POST /oauth/token refresh_token=R1\n        Auth--&gt;&gt;App1: 200 access_token, refresh_token=R2\n        Note over Auth: R1 \u043f\u043e\u043c\u0435\u0447\u0435\u043d \u043a\u0430\u043a \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439\n    and\n        App2-&gt;&gt;Auth: POST /oauth/token refresh_token=R1\n        Auth--&gt;&gt;App2: 400 token_reused\n        Note over Auth: \u0413\u0440\u0443\u043f\u043f\u0430 \u043f\u043e\u043c\u0435\u0447\u0435\u043d\u0430 \u043a\u0430\u043a \u0441\u043a\u043e\u043c\u043f\u0440\u043e\u043c\u0435\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0430\u044f\n    end</code></pre>"},{"location":"#53-challenge","title":"5.3 \u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f Challenge","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Created : \u0421\u043e\u0437\u0434\u0430\u043d \u0437\u0430\u043f\u0440\u043e\u0441\n    Created --&gt; Delivered : OTP \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\n    Delivered --&gt; Verified : \u041a\u043e\u0434 \u0432\u0432\u0435\u0434\u0451\u043d \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\n    Delivered --&gt; Expired : \u0418\u0441\u0442\u0451\u043a TTL\n    Verified --&gt; Redeemed : \u041a\u043e\u0434 \u043e\u0431\u043c\u0435\u043d\u044f\u043d \u043d\u0430 \u0442\u043e\u043a\u0435\u043d\u044b\n    Expired --&gt; [*]\n    Redeemed --&gt; [*]</code></pre>"},{"location":"#6-api-specification","title":"6. API Specification","text":""},{"location":"#_7","title":"\u041e\u0431\u0437\u043e\u0440 \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0445 \u0442\u043e\u0447\u0435\u043a","text":"Method Endpoint \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 POST <code>/auth/start</code> \u0417\u0430\u043f\u0443\u0441\u043a \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 OTP POST <code>/auth/otp/verify</code> \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 OTP-\u043a\u043e\u0434\u0430 \u2192 authorization_code POST <code>/oauth/token</code> \u041e\u0431\u043c\u0435\u043d \u043a\u043e\u0434\u0430 \u043d\u0430 \u0442\u043e\u043a\u0435\u043d\u044b / \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 POST <code>/auth/logout</code> \u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 POST <code>/auth/logout/all</code> \u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0432\u0441\u0435\u0445 \u0441\u0435\u0441\u0441\u0438\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f GET <code>/.well-known/jwks.json</code> \u041f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0435 \u043a\u043b\u044e\u0447\u0438 \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 JWT <p>\u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435: \u041f\u043e\u043b\u043d\u0430\u044f \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0438 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u2014 \u0432 <code>api/openapi.yml</code>.</p>"},{"location":"#7","title":"7. \u041c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445","text":""},{"location":"#er-","title":"ER-\u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430 (\u0434\u0435\u0442\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445)","text":"<pre><code>erDiagram\n    USER {\n        uuid id PK\n        string identifier \"phone/email\"\n        string totp_secret \"encrypted, nullable\"\n        timestamp created_at\n        timestamp updated_at\n        string status \"active|blocked|pending\"\n    }\n\n    CHALLENGE {\n        uuid id PK\n        uuid user_id FK\n        string channel \"sms|email|totp\"\n        string otp_hash \"bcrypt+pepper\"\n        string status \"created|delivered|verified|expired|redeemed\"\n        timestamp expires_at\n        int attempt_count \"default 0\"\n        timestamp created_at\n        timestamp updated_at\n    }\n\n    SESSION {\n        uuid id PK\n        uuid user_id FK\n        uuid refresh_group_id FK\n        string device_info \"JSON, nullable\"\n        string session_key \"per-session encryption key\"\n        timestamp created_at\n        timestamp last_used_at\n        string status \"active|revoked|expired\"\n    }\n\n    REFRESH_GROUP {\n        uuid id PK\n        uuid user_id FK\n        timestamp created_at\n        string status \"active|compromised\"\n        timestamp compromised_at \"nullable\"\n    }\n\n    REFRESH_TOKEN {\n        uuid id PK\n        uuid session_id FK\n        uuid refresh_group_id FK\n        string token_hash \"bcrypt+pepper\"\n        timestamp expires_at\n        timestamp used_at \"nullable\"\n        string status \"active|used|revoked\"\n        string successor_id \"nullable, points to next token\"\n    }\n\n    AUTHORIZATION_CODE {\n        uuid id PK\n        uuid challenge_id FK\n        string code_hash \"bcrypt+pepper\"\n        string code_challenge \"PKCE challenge\"\n        timestamp expires_at\n        timestamp redeemed_at \"nullable\"\n        string status \"active|redeemed|expired\"\n    }\n\n    OTP_ATTEMPT {\n        uuid id PK\n        uuid challenge_id FK\n        string ip_address\n        string user_agent\n        timestamp attempted_at\n        boolean success\n    }\n\n    USER ||--o{ CHALLENGE : creates\n    USER ||--o{ SESSION : has\n    USER ||--o{ REFRESH_GROUP : owns\n    SESSION ||--o{ REFRESH_TOKEN : issues\n    REFRESH_GROUP ||--o{ REFRESH_TOKEN : groups\n    CHALLENGE ||--o{ AUTHORIZATION_CODE : generates\n    CHALLENGE ||--o{ OTP_ATTEMPT : logs</code></pre>"},{"location":"#_8","title":"\u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f","text":"<ul> <li>\u0421\u0435\u043a\u0440\u0435\u0442\u044b (OTP, \u043a\u043e\u0434\u044b, \u0442\u043e\u043a\u0435\u043d\u044b) \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0432\u0438\u0434\u0435 \u0445\u044d\u0448\u0435\u0439; \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u0430\u044f \u0441\u043e\u043b\u044c + \u00abpepper\u00bb.</li> <li>\u0421\u0435\u0441\u0441\u0438\u043e\u043d\u043d\u044b\u0435 \u043a\u043b\u044e\u0447\u0438 \u2014 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0441\u0435\u0441\u0441\u0438\u0438, \u0440\u043e\u0442\u0430\u0446\u0438\u044f \u043f\u0440\u0438 refresh.</li> <li>\u0418\u043d\u0434\u0435\u043a\u0441\u044b: <code>expires_at</code>, <code>user_id+status</code>, <code>group_id+status</code>, <code>token_hash</code>.</li> <li>\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0447\u0438\u0441\u0442\u043a\u0430 \u043f\u0440\u043e\u0441\u0440\u043e\u0447\u0435\u043d\u043d\u044b\u0445 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 (TTL).</li> <li>\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u044b\u0439 \u0432\u044b\u0431\u043e\u0440: \u0425\u0440\u0430\u043d\u0438\u043c refresh tokens \u0434\u043b\u044f \u043c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u043e\u0433\u043e revoke \u0438 \u0440\u043e\u0442\u0430\u0446\u0438\u0438, access tokens \u043e\u0441\u0442\u0430\u044e\u0442\u0441\u044f stateless JWT.</li> </ul>"},{"location":"#8","title":"8. \u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c","text":""},{"location":"#jwt-claims","title":"JWT (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 claims)","text":"<p><code>iss</code>, <code>aud</code>, <code>sub</code>, <code>iat</code>, <code>exp</code>, <code>jti</code> (\u043f\u0440\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 <code>sid</code>, <code>acr</code>, <code>amr=[\"otp\"]</code>).</p> <p>\u041f\u0440\u0438\u043c\u0435\u0440 payload:</p> <pre><code>{\n  \"iss\": \"auth.company.com\",\n  \"aud\": \"mobile-app\",\n  \"sub\": \"user_12345\",\n  \"iat\": 1640995200,\n  \"exp\": 1640995800,\n  \"jti\": \"jwt_unique_id\",\n  \"sid\": \"session_abc123\",\n  \"acr\": \"2\",\n  \"amr\": [\"otp\"],\n  \"scope\": \"user:read user:write\"\n}\n</code></pre>"},{"location":"#jwks","title":"\u0420\u043e\u0442\u0430\u0446\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0439 (JWKS)","text":"<ul> <li>\u041c\u0438\u043d\u0438\u043c\u0443\u043c \u0434\u0432\u0430 \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043a\u043b\u044e\u0447\u0430 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e.</li> <li>\u041d\u0435 \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u0441\u0442\u0430\u0440\u044b\u0439 \u043a\u043b\u044e\u0447 \u0434\u043e \u0438\u0441\u0442\u0435\u0447\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0432\u044b\u0434\u0430\u043d\u043d\u044b\u0445 access_token.</li> <li>\u0423\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c JWKS HTTP-\u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430\u043c\u0438.</li> <li>\u0420\u0435\u0433\u0443\u043b\u044f\u0440\u043d\u0430\u044f \u0440\u043e\u0442\u0430\u0446\u0438\u044f (\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u043e \u0440\u0430\u0437 \u0432 3 \u043c\u0435\u0441\u044f\u0446\u0430).</li> </ul>"},{"location":"#_9","title":"\u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0430\u0442\u0430\u043a","text":"<ul> <li>Rate limiting \u043d\u0430 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u044d\u043d\u0434\u043f\u043e\u0438\u043d\u0442\u0430\u0445.</li> <li>PKCE \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d.</li> <li>Token rotation; \u043e\u0434\u043d\u043e\u0440\u0430\u0437\u043e\u0432\u043e\u0441\u0442\u044c \u043a\u043e\u0434\u043e\u0432/\u0442\u043e\u043a\u0435\u043d\u043e\u0432.</li> <li>Clock skew: \u0434\u043e\u043f\u0443\u0441\u043a \u00b160 \u0441\u0435\u043a\u0443\u043d\u0434.</li> <li>\u0421\u0435\u0441\u0441\u0438\u043e\u043d\u043d\u044b\u0435 \u043a\u043b\u044e\u0447\u0438 \u0434\u043b\u044f Perfect Forward Secrecy.</li> <li>Hybrid \u043f\u043e\u0434\u0445\u043e\u0434: stateless access tokens + stored refresh tokens \u0434\u043b\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044f.</li> </ul>"},{"location":"#9","title":"9. \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043e\u0448\u0438\u0431\u043e\u043a","text":"<p>\u0424\u043e\u0440\u043c\u0430\u0442: RFC 7807 (<code>application/problem+json</code>).</p> <p>\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u2014 \u0441\u043c. <code>api/openapi.yml</code>.</p>"},{"location":"#_10","title":"\u041a\u0430\u0442\u0430\u043b\u043e\u0433 \u043e\u0448\u0438\u0431\u043e\u043a","text":"HTTP code \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f 400 <code>otp_invalid</code> \u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 OTP \u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u0432\u0432\u043e\u0434 400 <code>otp_expired</code> \u0418\u0441\u0442\u0451\u043a \u0441\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f OTP \u0417\u0430\u043f\u0440\u043e\u0441\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u0434 400 <code>code_redeemed</code> \u041a\u043e\u0434 \u0443\u0436\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d \u041d\u0430\u0447\u0430\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0437\u0430\u043d\u043e\u0432\u043e 400 <code>channel_locked</code> \u0421\u043c\u0435\u043d\u0430 \u043a\u0430\u043d\u0430\u043b\u0430 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u0430 \u0414\u043e\u0436\u0434\u0430\u0442\u044c\u0441\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 400 <code>invalid_grant</code> \u041e\u0448\u0438\u0431\u043a\u0430 PKCE/\u043a\u043e\u0434\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b 400 <code>token_reused</code> \u041f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 refresh-\u0442\u043e\u043a\u0435\u043d\u0430 \u041f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0432\u0445\u043e\u0434 401 <code>unauthorized</code> \u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0410\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f 401 <code>invalid_token</code> \u041d\u0435\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439/\u043e\u0442\u043e\u0437\u0432\u0430\u043d\u043d\u044b\u0439 \u0442\u043e\u043a\u0435\u043d \u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d 401 <code>invalid_dpop</code> \u041d\u0430\u0440\u0443\u0448\u0435\u043d\u0430 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043a \u043a\u043b\u044e\u0447\u0443 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 \u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u0432\u0445\u043e\u0434/\u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0443 429 <code>rate_limited</code> \u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u044b \u043b\u0438\u043c\u0438\u0442\u044b; \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c Retry-After \u041f\u043e\u0434\u043e\u0436\u0434\u0430\u0442\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f"},{"location":"#10","title":"10. \u041c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 \u0438 \u043c\u0435\u0442\u0440\u0438\u043a\u0438","text":""},{"location":"#slo","title":"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c (\u043c\u0435\u0441\u044f\u0447\u043d\u044b\u0435 SLO)","text":"<ul> <li><code>/oauth/token</code>: \u2265 99.95%</li> <li><code>/auth/start</code>, <code>/auth/otp/verify</code>: \u2265 99.90%</li> <li><code>/.well-known/jwks.json</code>: \u2265 99.99%</li> </ul>"},{"location":"#otp-","title":"\u0417\u0430\u0434\u0435\u0440\u0436\u043a\u0430 (\u0431\u0435\u0437 \u0432\u043d\u0435\u0448\u043d\u0438\u0445 OTP-\u0448\u043b\u044e\u0437\u043e\u0432)","text":"<ul> <li><code>/auth/start</code>: P95 \u2264 250 \u043c\u0441, P99 \u2264 400 \u043c\u0441</li> <li><code>/auth/otp/verify</code>: P95 \u2264 150 \u043c\u0441, P99 \u2264 250 \u043c\u0441</li> <li><code>/oauth/token</code>: P95 \u2264 120 \u043c\u0441, P99 \u2264 200 \u043c\u0441</li> </ul>"},{"location":"#_11","title":"\u0410\u0443\u0434\u0438\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u0439","text":"<p><code>auth_start</code>, <code>otp_verify</code> (\u0443\u0441\u043f\u0435\u0445/\u043e\u0448\u0438\u0431\u043a\u0438), <code>token_issue</code>, <code>token_refresh</code>, <code>token_reused</code>, <code>logout</code>, <code>security_violation</code>.</p>"},{"location":"#11","title":"11. \u0412\u043d\u0435\u0434\u0440\u0435\u043d\u0438\u0435 \u0438 \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","text":""},{"location":"#_12","title":"\u042d\u0442\u0430\u043f\u044b \u0432\u043d\u0435\u0434\u0440\u0435\u043d\u0438\u044f","text":"<ol> <li>\u0411\u0430\u0437\u0430: <code>/auth/start</code>, <code>/auth/otp/verify</code>, <code>/oauth/token</code> (authorization_code).</li> <li>\u0420\u043e\u0442\u0430\u0446\u0438\u044f refresh \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f.</li> <li>\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u0430\u044f \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c (DPoP), \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u043d\u044b\u0439 \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433.</li> <li>\u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0438 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u0443\u0435\u043c\u043e\u0441\u0442\u0438.</li> </ol>"},{"location":"#dod","title":"\u041a\u0440\u0438\u0442\u0435\u0440\u0438\u0438 \u0433\u043e\u0442\u043e\u0432\u043d\u043e\u0441\u0442\u0438 (DoD)","text":"<ul> <li>\u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u044b \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438; \u043f\u043e\u043a\u0440\u044b\u0442\u0438\u0435 \u0442\u0435\u0441\u0442\u0430\u043c\u0438: \u043f\u043e\u0437\u0438\u0442\u0438\u0432\u043d\u044b\u0435 100%, \u043d\u0435\u0433\u0430\u0442\u0438\u0432\u043d\u044b\u0435 \u2265 90%.</li> <li>\u041f\u043e\u043b\u043d\u0430\u044f OpenAPI 3.1 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0441 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u043c\u0438.</li> <li>\u041d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u044b \u043c\u0435\u0442\u0440\u0438\u043a\u0438 \u0438 \u0430\u043b\u0435\u0440\u0442\u044b; \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u044b runbooks.</li> <li>\u041d\u0430\u0433\u0440\u0443\u0437\u043e\u0447\u043d\u043e\u0435 \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0439\u0434\u0435\u043d\u043e; security-review \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d.</li> </ul>"},{"location":"glossary/","title":"\u0413\u043b\u043e\u0441\u0441\u0430\u0440\u0438\u0439","text":"OTP \u041e\u0434\u043d\u043e\u0440\u0430\u0437\u043e\u0432\u044b\u0439 \u043a\u043e\u0434 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f (One-Time Password). DPoP \u041f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u0442\u043e\u043a\u0435\u043d\u0430 \u043a \u043a\u043b\u044e\u0447\u0443 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 (Demonstration of Proof-of-Possession). JWT \u041f\u043e\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0442\u043e\u043a\u0435\u043d \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0441 \u043a\u043e\u0440\u043e\u0442\u043a\u0438\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c \u0436\u0438\u0437\u043d\u0438 (\u043e\u0431\u044b\u0447\u043d\u043e 5\u201315 \u043c\u0438\u043d\u0443\u0442). JWKS \u041d\u0430\u0431\u043e\u0440 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0445 \u043a\u043b\u044e\u0447\u0435\u0439 (JSON Web Key Set) \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043f\u043e\u0434\u043f\u0438\u0441\u0438 JWT. PKCE \u041c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u0437\u0430\u0449\u0438\u0442\u044b \u043f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0445 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 (S256: code_verifier/code_challenge) \u0432 OAuth 2.1. Access Token \u041a\u0440\u0430\u0442\u043a\u043e\u0436\u0438\u0432\u0443\u0449\u0438\u0439 \u0442\u043e\u043a\u0435\u043d \u0434\u043e\u0441\u0442\u0443\u043f\u0430; \u043f\u0440\u0435\u0434\u044a\u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a \u0440\u0435\u0441\u0443\u0440\u0441\u043d\u044b\u043c API. Refresh Token \u0414\u043e\u043b\u0433\u043e\u0436\u0438\u0432\u0443\u0449\u0438\u0439 \u0442\u043e\u043a\u0435\u043d \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f; \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0440\u043e\u0442\u0430\u0446\u0438\u044e \u0438 \u0434\u0435\u0442\u0435\u043a\u0446\u0438\u044e \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f. \u0413\u0440\u0443\u043f\u043f\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u041b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440 refresh-\u0442\u043e\u043a\u0435\u043d\u043e\u0432, \u043f\u043e\u0440\u043e\u0436\u0434\u0451\u043d\u043d\u044b\u0445 \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u0440\u043e\u0442\u0430\u0446\u0438\u0438; \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u0440\u0435\u0432\u0448\u0435\u0433\u043e \u0442\u043e\u043a\u0435\u043d\u0430 \u043f\u043e\u043c\u0435\u0447\u0430\u0435\u0442 \u0432\u0441\u044e \u0433\u0440\u0443\u043f\u043f\u0443 \u043a\u0430\u043a \u0441\u043a\u043e\u043c\u043f\u0440\u043e\u043c\u0435\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e. Authorization Code \u041e\u0434\u043d\u043e\u0440\u0430\u0437\u043e\u0432\u044b\u0439 \u043a\u043e\u0434, \u043e\u0431\u043c\u0435\u043d\u0438\u0432\u0430\u0435\u043c\u044b\u0439 \u043d\u0430 \u0442\u043e\u043a\u0435\u043d\u044b; \u0438\u043c\u0435\u0435\u0442 \u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 TTL. iss / aud / sub / iat / exp / jti / sid \u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u043f\u043e\u043b\u044f (claims) JWT: \u0438\u0437\u0434\u0430\u0442\u0435\u043b\u044c, \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u044c, \u0441\u0443\u0431\u044a\u0435\u043a\u0442, \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u0443\u0441\u043a\u0430, \u0438\u0441\u0442\u0435\u0447\u0435\u043d\u0438\u0435, \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0442\u043e\u043a\u0435\u043d\u0430, \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0441\u0435\u0441\u0441\u0438\u0438. acr / amr \u041f\u0440\u0438\u0437\u043d\u0430\u043a\u0438 \u0441\u043f\u043e\u0441\u043e\u0431\u0430 \u0438 \u00ab\u0441\u0438\u043b\u044b\u00bb \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438; <code>amr=[\"otp\"]</code> \u043e\u0442\u0440\u0430\u0436\u0430\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0434\u043d\u043e\u0440\u0430\u0437\u043e\u0432\u043e\u0433\u043e \u043a\u043e\u0434\u0430."},{"location":"api/","title":"API Reference","text":""}]}